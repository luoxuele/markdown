# 网络分层模型简介

## OSI七层体系结构
    应用层
    表示层
    会话层
    传输层
    网络层
    数据链路层
    物理层

## TCP/IP四层体系结构
    应用层
    传输层（tcp, udp）
    网络层（ip）
    网络接口层

## tcp/ip五层对等模型
    应用层  http,ftp,tftp,telnet,ssh,dns,smtp,pop3,https,nfs
    传输层  tcp,udp
    网络层  ip,ipv6,icmp,igmp,arp
    数据链路层  以太网，802.1
    物理层  有线，无线

### 传输层
    tcp
    udp

    udp 首部格式8字节
        16位源端口
        16位目的端口
        16位udp长度
        16位udp校验和
    
    tcp 首部 20字节固定首部
        选项

        2 Bytes 源端口
        2 Bytes 目的端口
        4 Bytes 序列号
        4 Bytes 确认号
            4 bits  数据偏移（首部的大小，单位是4 bytes）4位最大数是15，所以首部最大长度为60 bytes, 选项最大为40 bytes
            6 bits  保留
            URG 紧急标志
            ACK 确认标志
            PSH 推标志
            RSI 复位标志
            SYN 同步标志
            FIN 结束标志
        2 Bytes 窗口
        2 Bytes 校验和
        2 Bytes 紧急指针

        3 Bytes 选项长度（Byte）,没有就为0
        1 Bytes 填充



        


### 网络层（三层）
    ip数据报 20 bytes 固定首部+ 选项
    4 bits 版本 ipv4 ipv6
    4 bits 首部长度 单位4 bytes, 最大60字节， 可变部分最大40字节
    1 Bytes 区分服务
    2 Bytes 总长度  2**16 = 65536

    2 Bytes 标识    通常每发一个ip数据报，值加一，ip报文长度超过网络的MTC时必须分片，可以通过表示复原
    3 bits 标志     R,DF,MF三位，只有后两位有效，DF位：0表示分片，1不分片。 MF：0 表示最后一片， 1表示更多的分片
    15 bits 片偏移  本分片在原先数据报文相对于首部的偏移位，单位字节，所以需要乘以8

    1 Bytes 生存时间    每经过一个路由器，TTL减1，为0时丢弃该数据报
    1 Bytes 协议    指出IP报文携带的数据使用的是那种协议，即上层协议，tcp=6 udp=17 icmp=1 igmp=2
    2 Bytes 首部校验和  计算时把本16位 置0 计算，再把结果填回来

    4 Bytes 源ip地址
    4 Bytes 目的ip地址

    可选字段+ 填充 = 4 Bytes

    IP首部校验和的计算主要是两步：按位异或和取反，具体来说

    对于发送方计算检验和：

    1. 初始计算校验和字段时该字段全部用0填充；

    2. IP头部以16位为一个单位，逐个模2加（相当于异或）；
    3. 得到的结果取反，作为校验和放入校验和字段；

    对于接收者来说，验证也很简单：

    1. 对于接收的IP报文头部以16位为单位逐个求和；
    2. 若结果为1，则校验正确，否则出错丢弃；

    原理很简单，接收方的计算对象是A和A的反的异或，结果当然是1了！


### 数据链路层（2层）   Frame帧
    Ethernet II格式  以太网2
    目的mac 6 Bytes
    源mac   6 Bytes
    类型    2 Bytes
        0x0800 ipv4 2048
        0x0806 arp
    数据    46-1500
    FCS 4Bytes 帧校验序列
    以太网帧的开头还有8字节的前导字符（64 bit）
    7字节的前同步码（Preamble）,每个字节都是0xAA
    1字节的帧开始标识符 0xAB

    ieee 802.3格式
    目的mac
    源mac
    长度

    ieee 802.3
    帧初始同步 7字节长，每字节由10101010组成，使接收端同步
    开始分隔符 1字节长 由10101011组成，指示帧开始
    这2个字段正好和以太网的帧初始同步字段相同。

    目的地址
    源地址
    长度
    LLC 802.2
        DSAP
        ASAP

    IEEE 802.3 SNAP()
    虽然IEEE 802.3是标准，但没有被业界采用。以太网II已成事实标准。于是IEEE 802.3扩展产生 IEEE 802.3 SNAP 来兼容以太网网头部协议，在IEEE 802.2 LLC 头部后插入了SNAP头部



    

### MTU 最大传输单元
    指的是以太网帧的数据部分最大为1500 bytes
    加上14字节的帧头和4字节的帧尾校验，帧最大为1518字节
    以太网帧的大小 为 64 - 1518
    以太网帧数据的范围 在 46-1500之间，（减18）
    大于1518的称为巨型帧，小于64的称为碎片



# 协议
## 应用层
    http
    ssh
    ftp
    dns
    dhcp
    snmp
    smtp
    tftp

## 传输层
    tcp 
    udp

## 网络层
    ip
    icmp
    igmp
    arp
    rarp

## 数据链路层
    


### 802.1q   vlan tag